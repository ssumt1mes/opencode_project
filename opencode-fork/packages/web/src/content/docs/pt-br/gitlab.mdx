---
title: GitLab
description: Use opencode em problemas e solicitações de mesclagem do GitLab.
---

opencode se integra ao seu fluxo de trabalho do GitLab através do seu pipeline CI/CD do GitLab ou com o GitLab Duo.

Em ambos os casos, o opencode será executado em seus runners do GitLab.

---

## GitLab CI

opencode funciona em um pipeline regular do GitLab. Você pode integrá-lo a um pipeline como um [componente CI](https://docs.gitlab.com/ee/ci/components/)

Aqui estamos usando um componente CI/CD criado pela comunidade para opencode — [nagyv/gitlab-opencode](https://gitlab.com/nagyv/gitlab-opencode).

---

### Recursos

- **Use configuração personalizada por trabalho**: Configure o opencode com um diretório de configuração personalizado, por exemplo `./config/#custom-directory` para habilitar ou desabilitar funcionalidades por invocação do opencode.
- **Configuração mínima**: O componente CI configura o opencode em segundo plano, você só precisa criar a configuração do opencode e o prompt inicial.
- **Flexível**: O componente CI suporta várias entradas para personalizar seu comportamento.

---

### Configuração

1. Armazene seu JSON de autenticação do opencode como variáveis de ambiente do tipo File em **Configurações** > **CI/CD** > **Variáveis**. Certifique-se de marcá-las como "Mascaradas e ocultas".
2. Adicione o seguinte ao seu arquivo `.gitlab-ci.yml`.

   ```yaml title=".gitlab-ci.yml"
   include:
     - component: $CI_SERVER_FQDN/nagyv/gitlab-opencode/opencode@2
       inputs:
         config_dir: ${CI_PROJECT_DIR}/opencode-config
         auth_json: $OPENCODE_AUTH_JSON # The variable name for your OpenCode authentication JSON
         command: optional-custom-command
         message: "Your prompt here"
   ```

Para mais entradas e casos de uso [consulte a documentação](https://gitlab.com/explore/catalog/nagyv/gitlab-opencode) deste componente.

---

## GitLab Duo

opencode se integra ao seu fluxo de trabalho do GitLab.
Mencione `@opencode` em um comentário, e o opencode executará tarefas dentro do seu pipeline CI do GitLab.

---

### Recursos

- **Triagem de problemas**: Peça ao opencode para analisar um problema e explicá-lo para você.
- **Corrigir e implementar**: Peça ao opencode para corrigir um problema ou implementar uma funcionalidade.
  Ele criará um novo branch e abrirá uma solicitação de mesclagem com as alterações.
- **Seguro**: O opencode é executado em seus runners do GitLab.

---

### Configuração

O opencode é executado em seu pipeline CI/CD do GitLab, aqui está o que você precisará para configurá-lo:

:::tip
Consulte a [**documentação do GitLab**](https://docs.gitlab.com/user/duo_agent_platform/agent_assistant/) para instruções atualizadas.
:::

1.  Configure seu ambiente GitLab
2.  Configure CI/CD
3.  Obtenha uma chave de API do provedor de modelo de AI
4.  Crie uma conta de serviço
5.  Configure variáveis de CI/CD
6.  Crie um arquivo de configuração de fluxo, aqui está um exemplo:

        <details>

    <summary>Configuração de fluxo</summary>

    ```yaml
    image: node:22-slim
    commands:
      - echo "Installing opencode"
      - npm install --global opencode-ai
      - echo "Installing glab"
      - export GITLAB_TOKEN=$GITLAB_TOKEN_OPENCODE
      - apt-get update --quiet && apt-get install --yes curl wget gpg git && rm --recursive --force /var/lib/apt/lists/*
      - curl --silent --show-error --location "https://raw.githubusercontent.com/upciti/wakemeops/main/assets/install_repository" | bash
      - apt-get install --yes glab
      - echo "Configuring glab"
      - echo $GITLAB_HOST
      - echo "Creating OpenCode auth configuration"
      - mkdir --parents ~/.local/share/opencode
      - |
        cat > ~/.local/share/opencode/auth.json << EOF
        {
          "anthropic": {
            "type": "api",
            "key": "$ANTHROPIC_API_KEY"
          }
        }
        EOF
      - echo "Configuring git"
      - git config --global user.email "opencode@gitlab.com"
      - git config --global user.name "OpenCode"
      - echo "Testing glab"
      - glab issue list
      - echo "Running OpenCode"
      - |
        opencode run "
        You are an AI assistant helping with GitLab operations.

        Context: $AI_FLOW_CONTEXT
        Task: $AI_FLOW_INPUT
        Event: $AI_FLOW_EVENT

        Please execute the requested task using the available GitLab tools.
        Be thorough in your analysis and provide clear explanations.

        <important>
        Please use the glab CLI to access data from GitLab. The glab CLI has already been authenticated. You can run the corresponding commands.

        If you are asked to summarize an MR or issue or asked to provide more information then please post back a note to the MR/Issue so that the user can see it.
        You don't need to commit or push up changes, those will be done automatically based on the file changes you make.
        </important>
        "
      - git checkout --branch $CI_WORKLOAD_REF origin/$CI_WORKLOAD_REF
      - echo "Checking for git changes and pushing if any exist"
      - |
        if ! git diff --quiet || ! git diff --cached --quiet || [ --not --zero "$(git ls-files --others --exclude-standard)" ]; then
          echo "Git changes detected, adding and pushing..."
          git add .
          if git diff --cached --quiet; then
            echo "No staged changes to commit"
          else
            echo "Committing changes to branch: $CI_WORKLOAD_REF"
            git commit --message "Codex changes"
            echo "Pushing changes up to $CI_WORKLOAD_REF"
            git push https://gitlab-ci-token:$GITLAB_TOKEN@$GITLAB_HOST/gl-demo-ultimate-dev-ai-epic-17570/test-java-project.git $CI_WORKLOAD_REF
            echo "Changes successfully pushed"
          fi
        else
          echo "No git changes detected, skipping push"
        fi
    variables:
      - ANTHROPIC_API_KEY
      - GITLAB_TOKEN_OPENCODE
      - GITLAB_HOST
    ```

        </details>

Você pode consultar a [documentação dos agentes da CLI do GitLab](https://docs.gitlab.com/user/duo_agent_platform/agent_assistant/) para instruções detalhadas.

---

### Exemplos

Aqui estão alguns exemplos de como você pode usar o opencode no GitLab.

:::tip
Você pode configurar para usar uma frase de gatilho diferente de `@opencode`.
:::

- **Explicar um problema**

  Adicione este comentário em um problema do GitLab.

  ```
  @opencode explain this issue
  ```

  O opencode lerá o problema e responderá com uma explicação clara.

- **Corrigir um problema**

  Em um problema do GitLab, diga:

  ```
  @opencode fix this
  ```

  O opencode criará um novo branch, implementará as alterações e abrirá uma solicitação de mesclagem com as alterações.

- **Revisar solicitações de mesclagem**

  Deixe o seguinte comentário em uma solicitação de mesclagem do GitLab.

  ```
  @opencode review this merge request
  ```

  O opencode revisará a solicitação de mesclagem e fornecerá feedback.
